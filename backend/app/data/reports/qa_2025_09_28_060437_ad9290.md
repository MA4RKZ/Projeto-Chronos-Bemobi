# Análise - PIX – Timeout na confirmação
*Área:* pix

## Evidências
- app/data/uploads/evidencia_pix_timeout.txt.txt

## Trecho extraído
```
Caso: pagamento PIX – timeout na confirmação

Passos:
1) Abre checkout
2) Seleciona método PIX
3) Gera QR Code (txid=TX123-ABC)
4) Cliente paga via app do banco
5) Aguarda retorno do status no checkout por 60s

Logs (aplicação):
[12:01:04.112] checkout:create txid=TX123-ABC amount=49.90
[12:01:05.902] qr:generated txid=TX123-ABC qrcode=0002012658...
[12:01:39.070] poll:status txid=TX123-ABC -> PENDING
[12:02:05.444] error: PIX confirmation timeout (408) txid=TX123-ABC

Logs (webhook):
-- nenhum webhook recebido dentro do período do teste --

Resultado esperado:
- status=settled em até 30s OU
- fallback de retry (nova consulta ao gateway) + registro de tentativa

Resultado observado:
- timeout após 60s, sem confirmação final
- sem evidência de webhook payment_settled
- sem registro de retry ou política de reprocessamento

Notas:
- Não há menção explícita à validação de idempotência
- Não foi verificado cabeçalho de assinatura do webhook

```

## Saída do LLM (raw)
```
```json
{
  "title": "PIX – Timeout na confirmação",
  "evaluation": {
    "criteria": [
      {
        "name": "msg de erro",
        "result": "OK",
        "reason": "O log registra um erro com a mensagem 'timeout after 60s, without final confirmation' (tempo limite após 60 segundos, sem confirmação final)."
      },
      {
        "name": "retry_policy",
        "result": "NOK",
        "reason": "Não há registro de uma política de reintentos ou tentativas adicionais para o pagamento. O log indica um timeout após 60s sem qualquer evidência de retry."
      },
      {
        "name": "idempotencia",
        "result": "NOK",
        "reason": "Não há menção explícita à validação de idempotência, nem no registro de logs ou nas recomendações. Isso pode levar a processos duplicados."
      }
    ]
  },
  "suggestions": [
    {
      "description": "Implementar uma política de reintentos (retry policy) para o pagamento PIX.",
      "details": "Adicionar lógica que permita novas consultas ao gateway após um timeout, com intervalos definidos."
    },
    {
      "description": "Validar a idempotência no recebedor do webhook.",
      "details": "Implementar mecanismos para garantir que cada webhook seja processado apenas uma vez, mesmo em caso de duplicação ou perda de mensagens."
    }
  ],
  "additional_cases": [
    {
      "title": "PIX – Timeout com retry",
      "description": "Teste a implementação da política de reintentos para ver se o pagamento é concluído após um timeout.",
      "steps": [
        "Abre checkout",
        "Seleciona método PIX",
        "Gera QR Code (txid=TX123-ABC)",
        "Cliente paga via app do banco",
        "Aguarda retorno do status no checkout por 60s"
      ],
      "expected_result": "status=settled em até 30s ou fallback de retry + registro de tentativa."
    },
    {
      "title": "PIX – Idempotência com webhook",
      "description": "Teste a validação de id
```